{% extends "layout.html" %}

{% block main %}
<div class="container-fluid">
    <div class="row">
        <main class="col-md-11 container">

            <div id="markdown-display" style="overflow: scroll;" class="p-3 container">
               <div class="row">
                         <!-- Markdown content will be displayed here -->
                        <!-- Basic tree search  -->
                        <h4>{{ name | default("Chapters")}}</h4><hr>
                        {% if tree %}
                            {% set size = tree.maxDepth(starting_level=1) %}
                        <script src="/static/js/tree.js"></script>
                        <div class="tree-menu col-md-2">
                            <button  class="btn btn-lg btn-block mx-1">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8"/>
                                  </svg>
                            </button>
                            <button class="btn btn-lg btn-block mx-1">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-right" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8"/>
                                  </svg>
                            </button>
                        </div>
                        <div class="tree-container col-md-7" style="overflow: scroll;">                  
                            <div id="tree" class="tree mt-3" style="overflow: scroll;">
                                <div id="tree-head" class="tree-node tree-head" children="{{tree.children}}">
                                    <div class="symbol"">{{tree.head}} <span class="badge bg-primary">Head</span></div>
                                    <div class="description">{{ tree.description }}</div>
                                </div>
                                
                                <div id="tree-body" style="z-index: 10;">
                                    {% for node in tree.children recursive %}
                                        {% if node.children %}
                                        <div class="branch-head d-flex mx-4 mb-2" id="{{node.head}}" children="{{node.children}}">
                                            <div class="tree-node">
                                                <div class="symbol">{{ node.head }}
                                                    <span class="position-absolute top-50 start-0 translate-middle p-2 border border-light rounded-circle node-link">
                                                        <span class="visually-hidden">New alerts</span>
                                                    </span>
                                                    
                                                </div>
                                                <div class="description">{{ node.description }}</div>
                                            </div>
                                            <!--Create children recursively by jumping back to the loop with the child as 'tree' (jinja does the work just explaining)-->
                                            <div class="branch-children ">
                                                {{ loop(node.children) }}
                                            </div>
                                        {% else %}
                                        <div class="leaf-branch d-flex mx-4 mb-2" id="{{node.head}}" children="0">
                                            <div class="tree-node leaf">
                                                <div class="symbol">{{ node.head }}
                                                    <span class="position-absolute top-50 start-0 translate-middle p-2 border border-light rounded-circle node-link">
                                                        <span class="visually-hidden">New alerts</span>
                                                    </span>
                                                    
                                                </div>
                                                <div class="description">{{ node.description }}</div>
                                            </div>

                                        {% endif %}
                                        </div>
                                    {% endfor %}
                                </div>
                                <!--TODO : populate node links-->
                                <div id="node-links" class="node-links mt-3 position-absolute" style="z-index: 1;">

                                    </svg>
                                </div>
                            <!--Tree end below-->
                            </div>
                            </div>
                        {% endif %}

                
                        <div class="col-md-3">
                            <h1>test</h1>
                            {% if exercice %}
                                {{ exercice | safe }}
                            {% endif %}
                        </div>
            </div>

               </div>  

                <div class="menu mt-3">
                    <form action="/study" method="post">
                    <div class="input-group mb-3 ">
                        <input name="query" type="text" class="form-control" placeholder="...">
                        <button class="input-group-text" id="basic-addon1">Ask</button>
                    </form>  
                </div>
                        <!-- Add menu items here -->
            </div>
        </main>
                <aside class="col-md-1 bg-light border-left" id="todo-aside">
                    <h5>Todos</h5>
                    <!-- Add todo items here -->
                    <ul>
                    {% for task in todo %}
                        <li>{{task}}</li>
                    {% endfor %}
                    </ul>
                </aside>

    </div>
</div>
{% endblock %}